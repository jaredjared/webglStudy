const fs = require('fs')
const _ = require('lodash')
const req = require('./req')
const pwd = process.cwd()

let login = module.exports = {}

/**
 * cms login
 * @params {String} user
 * @params {String} pwd
 */
login.login = function (user, pwd) {
  return new Promise((resolve, reject) => {
    let ret = {
      code: 0,
      msg: '登录成功',
      data: {}
    }

    if (!_.isString(user)) {
      ret.code = 5001
      ret.msg = '用户名必须为字符'

      resolve(ret)
    }

    if (!_.isString(pwd)) {
      ret.code = 5001
      ret.msg = '密码必须为字符串'

      resolve(ret)
    }

    const url = 'http://passport.webdev.com/php/login.php'

    req.post(url, {
      user: user,
      pwd: pwd
    }, false).then((res) => {
      resolve(res)
    }, (err) => {
      reject(err)
    })
  })
}

login.logout = function () {
  return new Promise((resolve, reject) => {
    fs.unlink(pwd + '/config/cookie.json', err => {
      let ret = {
        code: 0,
        msg: '登出成功',
        data: {}
      }

      if (err) {
        ret.msg = '登出失败'
      }
      resolve(ret)
    })
  })
}
